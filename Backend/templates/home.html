{% block content %}

<form
  class="form-horizontal"
  action="{% url 'home' %}"
  method="post"
  enctype="multipart/form-data"
>
  {% csrf_token %}

  <input type="file" name="image_file" />
  <input type="submit" value="submit" />
</form>

{% if image_url %}
<p>File uploaded at: <a href="{{ image_url }}">{{ image_url }}</a></p>
{% endif %} {% if messages %}
<script>
  // console error messages
  {% for message in messages %}
  console.error("{{ message }}");
  {% endfor %}
</script>
{% endif %} {% if user.is_authenticated == False %}
<a class="btn btn-link" href="{{ FORTY_TWO_URL }}"> login 42</a>
{% endif %} {% if user.is_authenticated %}
<p>Welcome, {{ user.username }}!</p>
<div class="container">User Data</div>
<a href="{% url 'logged_out' %}">Logout</a>
{% endif %}

<script>
  fetch("/get_user_data/")
    .then((response) => response.json())
    .then((data) => {
      console.log("Success:", data);
      const container = document.querySelector(".container");
      data.forEach((obj) => {
        Object.entries(obj).forEach((key, value) => {
          container.innerHTML +=
            "<p>" + key[0].toUpperCase() + ": " + key[1] + "</p>";
        });
      });
    })
    .catch((error) => {
      console.error("Error:", error);
    });
</script>
{% endblock %}
